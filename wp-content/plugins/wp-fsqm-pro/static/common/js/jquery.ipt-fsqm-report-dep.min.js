!function(e){"use strict";var t={defaults:{settings:{},survey:{},feedback:{},wpnonce:"",ajaxurl:"",form_id:0,do_data:!1,do_data_nonce:"",action:"ipt_fsqm_report",query_elements:{},sensitive_data:!1,sensitive_data_nonce:""},init:function(a){var r=e.extend(!0,{},t.defaults,a);return e(this).each(function(){t.populate_report.apply(this,[r])})},populate_report:function(a){a.progress_bar=e(this).find(".ipt_fsqm_report_progressbar").eq(0).progressbar(),a.loader=e(this).find(".ipt_fsqm_report_ajax").eq(0),a.container=e(this),a.printer=e("#ipt_fsqm_report_button_container_"+a.form_id),a.printer.hide(),e(this).data("ipt_fsqm_report_op",a),t.generate_report.apply(this,[0,a])},object_length:function(e){if("object"!=typeof e)return!1;var t,a=0;for(t in e)e.hasOwnProperty(t)&&a++;return a},number_format:function(e){var t=parseFloat(e);return isNaN(t)?e:parseInt(100*e,10)/100},appendToTableInPositionForMinMax:function(e,t,a,r,n,i,s,o,d){if(!i.length)return void(null===r?a.append(e):r.after(e));var l=parseFloat(i[0]),p=parseFloat(i[1]);if(s=parseFloat(s),o=parseFloat(o),d=parseFloat(d),t.find("tbody tr td."+n).length&&!(isNaN(l)||isNaN(p)||isNaN(s)||isNaN(o)||isNaN(d)))for(var u=l,v=l;u>=s||v<=o;u-=d,v+=d){var c=t.find('td[data-value-min="'+u+'"].'+n);if(c.length)for(var f=p,g=p;f>=s||g<=o;f-=d,g+=d){if(c.filter('td[data-value-max="'+f+'"].'+n).length)return void c.filter('td[data-value-max="'+f+'"].'+n).parent().after(e);if(c.filter('td[data-value-max="'+g+'"].'+n).length)return void c.filter('td[data-value-max="'+g+'"].'+n).parent().before(e)}var _=t.find('td[data-value-min="'+v+'"].'+n);if(_.length)for(var f=p,g=p;f>=s||g<=o;f-=d,g+=d){if(_.filter('td[data-value-max="'+f+'"].'+n).length)return void _.filter('td[data-value-max="'+f+'"].'+n).parent().after(e);if(_.filter('td[data-value-max="'+g+'"].'+n).length)return void _.filter('td[data-value-max="'+g+'"].'+n).parent().before(e)}}null==r?a.append(e):r.after(e)},appendToTableInPositionForVal:function(e,t,a,r,n,i,s,o,d){if(i=parseFloat(i),s=parseFloat(s),o=parseFloat(o),d=parseFloat(d),t.find("tbody tr td."+n).length&&!(isNaN(i)||isNaN(s)||isNaN(o)||isNaN(d)))for(var l=i,p=i;l>=s||p<=o;l-=d,p+=d){var u=t.find('td[data-value="'+l+'"].'+n);if(u.length)return void u.parent().after(e);var v=t.find('td[data-value="'+p+'"].'+n);if(v.length)return void v.parent().before(e)}null==r?a.append(e):r.after(e)},updateCount:function(e,t){e.html(t)},calculateRating:function(e,a,r,n,i,s,o,d,l){var p,u,v,c,f,g,_,m,y=0,h=0;for(p in e)if(!isNaN(e[p]))if(y+=p*e[p],h+=e[p],void 0===a[p]?a[p]=e[p]:a[p]+=e[p],(u=r.find('td[data-value="'+p+'"].'+o)).length)u.text(a[p]);else{for(v="",c=1;c<=l.max;c++)v+=c<=p?iptFSQMReport.rating_img_full:iptFSQMReport.rating_img_empty;g='<tr class="'+s+'"><th>'+v+'</th><td class="'+o+'" data-value="'+p+'">'+a[p]+"</td></tr>",t.appendToTableInPositionForVal(g,r,n,i,o,p,l.min,l.max,l.step)}for(void 0===a.average_meta?a.average_meta={total:y,count:h}:(a.average_meta.total+=y,a.average_meta.count+=h),a.average=t.number_format(a.average_meta.total/a.average_meta.count),_="",m=Math.floor(a.average),f=1;f<=l.max;f++)m>=f?_+=iptFSQMReport.rating_img_full:m+1===f&&f===Math.round(a.average)?_+=iptFSQMReport.rating_img_half:_+=iptFSQMReport.rating_img_empty;t.updateCount(d.find("span.avg"),a.average),t.updateCount(d.find("span.avg_img"),_),t.updateCount(d.find("span.avg_count"),a.average_meta.count)},calculateSlider:function(e,a,r,n,i,s,o,d,l){var p,u,v,c=0,f=0;void 0===l.prefix&&(l.prefix=""),void 0===l.suffix&&(l.suffix="");for(p in e)isNaN(e[p])||(c+=p*e[p],f+=e[p],void 0===a[p]?a[p]=e[p]:a[p]+=e[p],(u=r.find('td[data-value="'+p+'"].'+o)).length?u.text(a[p]):(v='<tr class="'+s+'"><th>'+l.prefix+p+l.suffix+'</th><td class="'+o+'" data-value="'+p+'">'+a[p]+"</td></tr>",t.appendToTableInPositionForVal(v,r,n,i,o,p,l.min,l.max,l.step)));void 0===a.average_meta?a.average_meta={total:c,count:f}:(a.average_meta.total+=c,a.average_meta.count+=f),a.average=t.number_format(a.average_meta.total/a.average_meta.count),t.updateCount(d.find("span.avg"),l.prefix+a.average+l.suffix),t.updateCount(d.find("span.avg_count"),a.average_meta.count)},calculateRange:function(e,a,r,n,i,s,o,d,l){var p,u,v,c,f,g,_=0,m=0,y=0;void 0===l.prefix&&(l.prefix=""),void 0===l.suffix&&(l.suffix="");for(p in e)isNaN(e[p])||(u=p.split(","),y+=e[p],_+=u[0]*e[p],m+=u[1]*e[p],v=u[0]+iptFSQMReport.range_text+u[1],g=l.prefix+u[0]+l.suffix+iptFSQMReport.range_text+l.prefix+u[1]+l.suffix,void 0===a[v]?a[v]=e[p]:a[v]+=e[p],(c=r.find('td[data-value-min="'+u[0]+'"][data-value-max="'+u[1]+'"].'+o)).length?c.text(a[v]):(f='<tr class="'+s+'"><th>'+g+'</th><td class="'+o+'" data-value-min="'+u[0]+'" data-value-max="'+u[1]+'">'+a[v]+"</td></tr>",t.appendToTableInPositionForMinMax(f,r,n,i,o,u,l.min,l.max,l.step)));void 0===a.average_meta?a.average_meta={total_min:_,total_max:m,count:y}:(a.average_meta.total_min+=_,a.average_meta.total_max+=m,a.average_meta.count+=y),a.average=l.prefix+t.number_format(a.average_meta.total_min/a.average_meta.count)+l.suffix+iptFSQMReport.range_text+l.prefix+t.number_format(a.average_meta.total_max/a.average_meta.count)+l.suffix,t.updateCount(d.find("span.avg"),a.average),t.updateCount(d.find("span.avg_count"),a.average_meta.count)},populateSliderChart:function(e,a,r,n){var i=new Array;for(var s in e)isNaN(s)||(i[i.length]=parseFloat(s));i.sort(function(e,t){return t-e});var o=new Array;o[0]=new Array(iptFSQMReport.g_data.ct_label),o[1]=new Array(iptFSQMReport.g_data.vl_label);for(var s in i){var d=e[i[s]]+" "+(0==e[i[s]]||1==e[i[s]]?iptFSQMReport.g_data.sl_head_label_s:iptFSQMReport.g_data.sl_head_label_p);o[0][o[0].length]=d,o[1][o[1].length]=i[s]}o[0][o[0].length]=iptFSQMReport.g_data.avg,o[1][o[1].length]=e.average,t.drawBarChart(n,o,iptFSQMReport.g_data.sl_label,iptFSQMReport.g_data.ct_label,a,r)},populateRangeChart:function(e,a,r,n,i){var s=new Array;for(var o in e){var d=o.split(iptFSQMReport.range_text);2==d.length&&(s[s.length]=d)}s.sort(function(e,t){return e[0]>t[0]?-1:e[0]<t[0]?1:e[1]>t[1]?-1:e[1]<t[1]?1:0});var l=new Array;for(var p in s){var u=s[p].join(iptFSQMReport.range_text),v=e[u]+" "+(0==e[u]||1==e[u]?iptFSQMReport.g_data.sl_head_label_s:iptFSQMReport.g_data.sl_head_label_p);l[l.length]=[v,parseFloat(i.min),parseFloat(s[p][0]),parseFloat(s[p][1]),parseFloat(i.max)]}t.drawCandlestickChart(n,l,iptFSQMReport.g_data.sg_label,iptFSQMReport.g_data.ct_label,a,r,i)},drawPieChart:function(t,a,r,n){var i=google.visualization.arrayToDataTable(a),s=new google.visualization.PieChart(t),o={title:r,is3D:!0,height:300,backgroundColor:"transparent",legend:{position:"bottom"},tooltip:{isHTML:!0}};void 0==n&&(n={}),o=e.extend({},o,n),s.draw(i,o),e(window).resize(e.debounce(250,function(){e(t).html(""),setTimeout(function(){(s=new google.visualization.PieChart(t)).draw(i,o)},200)})),e(document).on("fsqm.chartRedraw",e.debounce(250,function(){e(t).html(""),setTimeout(function(){(s=new google.visualization.PieChart(t)).draw(i,o)},200)}))},drawCandlestickChart:function(t,a,r,n,i,s,o,d){var l=google.visualization.arrayToDataTable(a,!0),p=new google.visualization.CandlestickChart(t),u={hAxis:{title:r},vAxis:{title:n,minValue:parseFloat(o.min),maxValue:parseFloat(o.max),viewWindow:{max:parseFloat(o.max),min:parseFloat(o.min)}},title:i,backgroundColor:"transparent",height:s,tooltip:{isHTML:!0},legend:"none"};void 0==d&&(d={}),u=e.extend({},u,d),p.draw(l,u),e(window).resize(e.debounce(250,function(){e(t).html(""),setTimeout(function(){(p=new google.visualization.CandlestickChart(t)).draw(l,u)},200)})),e(document).on("fsqm.chartRedraw",e.debounce(250,function(){e(t).html(""),setTimeout(function(){(p=new google.visualization.CandlestickChart(t)).draw(l,u)},200)}))},drawBarChart:function(t,a,r,n,i,s,o){var d=google.visualization.arrayToDataTable(a),l=new google.visualization.BarChart(t),p={hAxis:{title:r},vAxis:{title:n},title:i,backgroundColor:"transparent",height:s,tooltip:{isHTML:!0},legend:{position:"bottom"}};void 0==o&&(o={}),p=e.extend({},p,o),l.draw(d,p),e(window).resize(e.debounce(250,function(){e(t).html(""),setTimeout(function(){(l=new google.visualization.BarChart(t)).draw(d,p)},200)})),e(document).on("fsqm.chartRedraw",e.debounce(250,function(){e(t).html(""),setTimeout(function(){(l=new google.visualization.BarChart(t)).draw(d,p)},200)}))},generate_report:function(a,r){e.post(r.ajaxurl,{action:r.action,settings:r.settings,wpnonce:r.wpnonce,form_id:r.form_id,do_data:r.do_data,do_data_nonce:r.do_data_nonce,sensitive_data:r.sensitive_data,sensitive_data_nonce:r.sensitive_data_nonce,query_elements:r.query_elements,doing:a},function(n){if(null==n)return r.loader.find(".ipt_uif_ajax_loader_icon").removeClass("ipt_uif_ajax_loader_spin"),void r.loader.find(".ipt_uif_ajax_loader_text").text("ServerSide Error");var i,s,o,d,l,p,u,v,c,f,g;for(var _ in r.survey.elements)if(void 0!=n.survey[_])switch(void 0==r.survey.data[_]&&(r.survey.data[_]=new Object),d=r.container.find(".ipt_fsqm_report_survey_"+_+" table.table_to_update").eq(0),l=d.find("td.data table"),v=d.next("div").find("table.others"),0==l.length&&(l=d),r.survey.elements[_].type){default:void 0!==iptFSQMReport.callbacks[r.survey.elements[_].type]&&"function"==typeof window[iptFSQMReport.callbacks[r.survey.elements[_].type]]&&window[iptFSQMReport.callbacks[r.survey.elements[_].type]].apply(this,[r.survey.elements[_],r.survey.data[_],n.survey[_],t,_,d,l,r]);break;case"radio":case"checkbox":case"select":case"thumbselect":for(m in n.survey[_])if("others_data"!=m)void 0==r.survey.data[_][m]&&(r.survey.data[_][m]=0),i=n.survey[_][m],isNaN(i)||(r.survey.data[_][m]+=i,t.updateCount(l.find("td.data_op_"+m),r.survey.data[_][m]));else if(void 0!=n.survey[_].others_data&&n.survey[_].others_data.length)for(g in n.survey[_].others_data)s=n.survey[_].others_data[g],r.do_data&&((c=v.find("tbody")).find("tr.empty").remove(),(L=e("<tr />")).append("<td>"+s.value+"</td>"),L.append('<td><a class="thickbox" href="'+r.ajaxurl+"?action=ipt_fsqm_quick_preview&id="+s.id+'">'+s.name+"</a>"),L.append("<td>"+s.email+"</td>"),c.append(L));break;case"slider":t.calculateSlider(n.survey[_],r.survey.data[_],l,l.find("tbody"),null,"slider_value_to_count_tr","slider_value_to_count",l.find("> tfoot > tr > th:first-child"),r.survey.elements[_].settings);break;case"range":t.calculateRange(n.survey[_],r.survey.data[_],l,l.find("tbody"),null,"range_value_to_count_tr","range_value_to_count",l.find("> tfoot > tr > th:first-child"),r.survey.elements[_].settings);break;case"grading":for(var m in n.survey[_]){var y=l.find("tr.grading_"+m+".head");"object"!=typeof r.survey.elements[_].settings.options[m]&&(r.survey.elements[_].settings.options[m]={label:r.survey.elements[_].settings.options[m],prefix:"",suffix:""}),y.length||(y=e('<tr class="grading_'+m+' head"><th class="head_th" rowspan="1">'+r.survey.elements[_].settings.options[m].label+"</th><th>"+iptFSQMReport.grading+"</th><th>"+iptFSQMReport.count+"</th></tr>"),l.find("tbody").append(y),y.after('<tr class="grading_'+m+'_avg avg head"><th>'+iptFSQMReport.avg+' <span class="avg_count">0</span> '+iptFSQMReport.avg_count+'</th><th><span class="avg">0</span></th><th>'+(r.survey.elements[_].settings.range?iptFSQMReport.avg_range:iptFSQMReport.avg_slider)+"</th></tr>")),void 0==r.survey.data[_][m]&&(r.survey.data[_][m]=new Object),r.survey.elements[_].settings.prefix=r.survey.elements[_].settings.options[m].prefix,r.survey.elements[_].settings.suffix=r.survey.elements[_].settings.options[m].suffix;h=[n.survey[_][m],r.survey.data[_][m],l,l.find("tbody"),y,"grading_"+m+"_value_to_count_tr","grading_"+m+"_value_to_count",l.find("tr.grading_"+m+"_avg th"),r.survey.elements[_].settings];r.survey.elements[_].settings.range?t.calculateRange.apply(this,h):t.calculateSlider.apply(this,h),y.find("th.head_th").attr("rowspan",l.find("tr.grading_"+m+"_value_to_count_tr").length+1)}break;case"spinners":for(var m in n.survey[_]){(y=l.find("tr.spinners_"+m+".head")).length||(y=e('<tr class="spinners_'+m+' head"><th class="head_th" rowspan="1">'+r.survey.elements[_].settings.options[m].label+"</th><th>"+iptFSQMReport.value+"</th><th>"+iptFSQMReport.count+"</th></tr>"),l.find("tbody").append(y),y.after('<tr class="spinners_'+m+'_avg avg head"><th>'+iptFSQMReport.avg+' <span class="avg_count">0</span> '+iptFSQMReport.avg_count+'</th><th><span class="avg">0</span></th><th>'+(r.survey.elements[_].settings.show_range?iptFSQMReport.avg_range:iptFSQMReport.avg_slider)+"</th></tr>")),void 0==r.survey.data[_][m]&&(r.survey.data[_][m]=new Object);h=[n.survey[_][m],r.survey.data[_][m],l,l.find("tbody"),y,"spinners_"+m+"_value_to_count_tr","spinners_"+m+"_value_to_count",l.find("tr.spinners_"+m+"_avg th"),r.survey.elements[_].settings];t.calculateSlider.apply(this,h),y.find("th.head_th").attr("rowspan",l.find("tr.spinners_"+m+"_value_to_count_tr").length+1)}break;case"starrating":case"scalerating":for(var m in n.survey[_]){(y=l.find("tr.rating_"+m+".head")).length||(y=e('<tr class="rating_'+m+' head"><th class="head_th" rowspan="1">'+r.survey.elements[_].settings.options[m]+"</th><th>"+iptFSQMReport.rating+"</th><th>"+iptFSQMReport.count+"</th></tr>"),l.find("tbody").append(y),y.after('<tr class="rating_'+m+'_avg avg head"><th>'+iptFSQMReport.avg+' <span class="avg_count">0</span> '+iptFSQMReport.avg_count+'</th><th><span class="avg_img"></span></th><th><span class="avg">0</span> '+(r.survey.elements[_].settings.show_range?iptFSQMReport.avg_range:iptFSQMReport.avg_slider)+"</th></tr>")),void 0==r.survey.data[_][m]&&(r.survey.data[_][m]=new Object);var h=[n.survey[_][m],r.survey.data[_][m],l,l.find("tbody"),y,"rating_"+m+"_value_to_count_tr","rating_"+m+"_value_to_count",l.find("tr.rating_"+m+"_avg th"),r.survey.elements[_].settings];t.calculateRating.apply(this,h),y.find("th.head_th").attr("rowspan",l.find("tr.rating_"+m+"_value_to_count_tr").length+1)}break;case"smileyrating":case"likedislike":for(var b in n.survey[_])if("feedback_data"==b){if(void 0!=n.survey[_].feedback_data&&n.survey[_].feedback_data.length&&r.do_data)for(var w in n.survey[_].feedback_data)s=n.survey[_].feedback_data[w],L=e("<tr>"),(c=v.find("tbody")).find("tr.empty").remove(),L.append("<td>"+s.entry+"</td>"),L.append("<td>"+s.rating+"</td>"),L.append('<td><a class="thickbox" href="'+r.ajaxurl+"?action=ipt_fsqm_quick_preview&id="+s.id+'">'+s.name+"</a>"),L.append("<td>"+s.email+"</td>"),c.append(L)}else void 0==r.survey.data[_][b]&&(r.survey.data[_][b]=0),r.survey.data[_][b]+=n.survey[_][b],l.find("td."+b).html(r.survey.data[_][b]);break;case"matrix_dropdown":for(var x in n.survey[_]){void 0==r.survey.data[_][x]&&(r.survey.data[_][x]=new Object);for(var k in n.survey[_][x]){void 0==r.survey.data[_][x][k]&&(r.survey.data[_][x][k]=new Object);for(var m in n.survey[_][x][k])void 0==r.survey.data[_][x][k][m]&&(r.survey.data[_][x][k][m]=0),e.isNumeric(n.survey[_][x][k][m])&&(r.survey.data[_][x][k][m]+=n.survey[_][x][k][m]),d.find("td.row-"+x+"-column-"+k+"-op-"+m).html(r.survey.data[_][x][k][m])}}break;case"matrix":for(var x in n.survey[_]){void 0==r.survey.data[_][x]&&(r.survey.data[_][x]=new Object);for(var k in n.survey[_][x])isNaN(n.survey[_][x][k])||(void 0==r.survey.data[_][x][k]?r.survey.data[_][x][k]=n.survey[_][x][k]:r.survey.data[_][x][k]+=n.survey[_][x][k],t.updateCount(l.find("td.row_"+x+"_col_"+k),r.survey.data[_][x][k]))}break;case"toggle":for(var F in n.survey[_])isNaN(n.survey[_][F])||(void 0==r.survey.data[_][F]?r.survey.data[_][F]=n.survey[_][F]:r.survey.data[_][F]+=n.survey[_][F],t.updateCount(l.find("td.data_op_"+F),r.survey.data[_][F]));break;case"sorting":for(var b in n.survey[_]){var R=t.object_length(r.survey.elements[_].settings.options);if(isNaN(n.survey[_][b])){if("orders"==b&&"object"==typeof n.survey[_][b])for(var M in n.survey[_][b])if(""!=M){if(void 0==r.survey.data[_].orders[M]){r.survey.data[_].orders[M]=n.survey[_][b][M];var S=M.split("-");l.find("tbody tr").length&&l.find("tbody").append('<tr class="head"><th colspan="3"></th></tr>');var Q=!0;for(var m in S)void 0!==r.survey.elements[_].settings.options[S[m]]&&(f="",1==Q?(Q=!1,f='<tr><td class="icons">'+iptFSQMReport.sorting_img+"</td><th>"+r.survey.elements[_].settings.options[S[m]].label+'</th><td rowspan="'+R+'" data="'+M+'"></td></tr>'):f='<tr><td class="icons">'+iptFSQMReport.sorting_img+"</td><th>"+r.survey.elements[_].settings.options[S[m]].label+"</th>",l.find("tbody").append(f))}else r.survey.data[_].orders[M]+=n.survey[_][b][M];t.updateCount(l.find('td[data="'+M+'"]'),r.survey.data[_].orders[M])}}else void 0==r.survey.data[_][b]?r.survey.data[_][b]=n.survey[_][b]:r.survey.data[_][b]+=n.survey[_][b]}}if(r.do_data)for(var C in r.feedback.elements)if("object"==typeof n.feedback[C])switch(d=r.container.find(".ipt_fsqm_report_feedback_"+C+" > div > div > table"),(c=d.find("> tbody")).find("tr.empty").remove(),r.feedback.elements[C].type){default:void 0!==iptFSQMReport.callbacks[r.feedback.elements[C].type]&&"function"==typeof window[iptFSQMReport.callbacks[r.feedback.elements[C].type]]&&window[iptFSQMReport.callbacks[r.feedback.elements[C].type]].apply(this,[r.feedback.elements[C],r.feedback.data[C],n.feedback[C],t,C,d,r]);break;case"upload":for(var j in n.feedback[C]){var N=n.feedback[C][j],q=N.uploads.length,T=0===q?1:q;if((L=e("<tr />")).append('<th rowspan="'+T+'"><a class="thickbox" href="'+r.ajaxurl+"?action=ipt_fsqm_quick_preview&id="+N.id+'">'+N.name+"</a>"),L.append('<td rowspan="'+T+'">'+N.date+"</td>"),0===q)L.append('<td rowspan="'+T+'">'+iptFSQMReport.noupload+"</td>"),c.append(L);else for(var A in N.uploads){var P=N.uploads[A],z='<a href="'+P.guid+'" target="_blank" title="'+P.filename+'">';""!==P.thumb_url&&(z+='<img src="'+P.thumb_url+'" /><br />'),z+=P.name+"</a>",L.append("<td>"+z+"</td>"),c.append(L),L=e("<tr />")}}break;case"feedback_large":case"feedback_small":case"mathematical":for(var E in n.feedback[C])s=n.feedback[C][E],(L=e("<tr />")).append("<th>"+s.value+"</th>"),L.append('<td><a class="thickbox" href="'+r.ajaxurl+"?action=ipt_fsqm_quick_preview&id="+s.id+'">'+s.name+"</a>"),L.append("<td>"+s.email+"</td>"),L.append("<td>"+s.phone+"</td>"),L.append("<td>"+s.date+"</td>"),c.append(L);break;case"signature":for(var E in n.feedback[C])s=n.feedback[C][E],L=e("<tr />"),""!=s.value?L.append('<th><img src="data:image/png;base64,'+s.value+'" style="max-width: 400px; height: auto;" /></th>'):L.append("<th></th>"),L.append('<td><a class="thickbox" href="'+r.ajaxurl+"?action=ipt_fsqm_quick_preview&id="+s.id+'">'+s.name+"</a>"),L.append("<td>"+s.email+"</td>"),L.append("<td>"+s.phone+"</td>"),L.append("<td>"+s.date+"</td>"),c.append(L);break;case"gps":for(var E in n.feedback[C])s=n.feedback[C][E],L='<tr><td rowspan="4"><a class="thickbox" href="'+r.ajaxurl+"?action=ipt_fsqm_quick_preview&id="+s.id+'">'+s.name+'</a></td><td colspan="2"><img src="'+s.map+'" height="300" width="500" /></td><td rowspan="4">'+s.email+'</td><td rowspan="4">'+s.date+"</td></tr>",L+="<tr><td>"+r.feedback.elements[C].settings.location_name_label+"</td><td>"+s.location_name+"</td></tr>",L+="<tr><td>"+r.feedback.elements[C].settings.lat_label+"</td><td>"+s.lat+"</td></tr>",L+="<tr><td>"+r.feedback.elements[C].settings.long_label+"</td><td>"+s.long+"</td></tr>",c.append(L);break;case"feedback_matrix":var B='<table class="ipt_fsqm_preview">',O="<tr><th></th>";for(var k in r.feedback.elements[C].settings.columns)O+="<th>"+r.feedback.elements[C].settings.columns[k]+"</th>";B+="<thead>"+(O+="</tr>")+"</thead><tfoot>"+O+"</tfoot><tbody>";for(var x in r.feedback.elements[C].settings.rows){B+="<tr><th>"+r.feedback.elements[C].settings.rows[x]+"</th>";for(var k in r.feedback.elements[C].settings.columns)B+='<td class="row-'+x+"-col-"+k+'"></td>';B+="</tr>"}B=e(B+="</tbody></table>");for(var E in n.feedback[C]){s=n.feedback[C][E];var I=B.clone();for(var x in s.matrix)for(var k in s.matrix[x])I.find(".row-"+x+"-col-"+k).html(s.matrix[x][k]);var L='<tr><td><a class="thickbox" href="'+r.ajaxurl+"?action=ipt_fsqm_quick_preview&id="+s.id+'">'+s.name+"</a></td>";L+='<td class="data matrix"></td>',L+="<td>"+s.email+"</td><td>"+s.date+"</td></tr>",(L=e(L)).find("td.matrix").append(I),c.append(L)}}if(r.progress_bar.progressbar("option","value",t.number_format(n.done)),100==n.done){r.container.find(".ipt_fsqm_report_container").show();var V=window.location.protocol;e.getScript(V+"//www.google.com/jsapi",function(){google.load("visualization","1.0",{packages:["corechart"],callback:function(){for(var a in r.survey.data)switch(d=r.container.find(".ipt_fsqm_report_survey_"+a+" > div > div > table"),p=d.find("td.visualization"),l=d.find("td.data"),r.survey.elements[a].type){default:void 0!==iptFSQMReport.gcallbacks[r.survey.elements[a].type]&&"function"==typeof window[iptFSQMReport.gcallbacks[r.survey.elements[a].type]]&&window[iptFSQMReport.gcallbacks[r.survey.elements[a].type]].apply(this,[r.survey.elements[a],r.survey.data[a],t,a,d,l,r]);break;case"radio":case"checkbox":case"select":case"thumbselect":u=document.createElement("div"),p.append(u),(o=new Array)[0]=[iptFSQMReport.g_data.op_label,iptFSQMReport.g_data.ct_label];for(var n in r.survey.data[a])void 0!==r.survey.data[a][n]&&("others"==n&&void 0!==r.survey.elements[a].settings.o_label?o[o.length]=[r.survey.elements[a].settings.o_label.replace(/(<([^>]+)>)/gi,""),r.survey.data[a][n]]:void 0!==r.survey.elements[a].settings.options[n]&&(o[o.length]=[r.survey.elements[a].settings.options[n].label.replace(/(<([^>]+)>)/gi,""),r.survey.data[a][n]]));b=r.survey.elements[a].title.replace(/(<([^>]+)>)/gi,"");t.drawPieChart(u,o,b);break;case"smileyrating":u=document.createElement("div"),p.append(u),(o=new Array)[0]=[iptFSQMReport.g_data.op_label,iptFSQMReport.g_data.ct_label];for(var i in r.survey.data[a])void 0!==r.survey.data[a][i]&&"feedback_data"!=i&&void 0!=r.survey.elements[a].settings.labels[i]&&(o[o.length]=[r.survey.elements[a].settings.labels[i].replace(/(<([^>]+)>)/gi,""),r.survey.data[a][i]]);b=r.survey.elements[a].title.replace(/(<([^>]+)>)/gi,"");t.drawPieChart(u,o,b);break;case"likedislike":u=document.createElement("div"),p.append(u),(o=new Array)[0]=[iptFSQMReport.g_data.op_label,iptFSQMReport.g_data.ct_label];for(var i in r.survey.data[a])void 0!==r.survey.data[a][i]&&"feedback_data"!=i&&void 0!=r.survey.elements[a].settings[i]&&(o[o.length]=[r.survey.elements[a].settings[i].replace(/(<([^>]+)>)/gi,""),r.survey.data[a][i]]);b=r.survey.elements[a].title.replace(/(<([^>]+)>)/gi,"");t.drawPieChart(u,o,b);break;case"slider":u=document.createElement("div"),p.append(u);b=r.survey.elements[a].title.replace(/(<([^>]+)>)/gi,"");t.populateSliderChart(r.survey.data[a],b,300,u);break;case"range":u=document.createElement("div"),p.append(u);b=r.survey.elements[a].title.replace(/(<([^>]+)>)/gi,"");t.populateRangeChart(r.survey.data[a],b,300,u,r.survey.elements[a].settings);break;case"grading":for(var n in r.survey.data[a])if(void 0!==r.survey.elements[a].settings.options[n]){x=(x="object"==typeof r.survey.elements[a].settings.options[n]?r.survey.elements[a].settings.options[n].label:r.survey.elements[a].settings.options[n]).replace(/(<([^>]+)>)/gi,"");s="grading";(v=e('<td colspan=""></td>')).attr("rowspan",d.find("tbody tr."+s+"_"+n+"_value_to_count_tr").length+2),d.find("tbody tr."+s+"_"+n+".head").prepend(v),u=document.createElement("div"),v.append(u),1==r.survey.elements[a].settings.range?t.populateRangeChart(r.survey.data[a][n],x,"auto",u,r.survey.elements[a].settings):t.populateSliderChart(r.survey.data[a][n],x,"auto",u)}break;case"spinners":case"starrating":case"scalerating":for(var n in r.survey.data[a])if(void 0!==r.survey.elements[a].settings.options[n]){"object"==typeof(x=r.survey.elements[a].settings.options[n])&&(x=x.label),x=x.replace(/(<([^>]+)>)/gi,"");var s="spinners"==r.survey.elements[a].type?"spinners":"rating",v=e('<td colspan=""></td>');v.attr("rowspan",d.find("tbody tr."+s+"_"+n+"_value_to_count_tr").length+2),d.find("tbody tr."+s+"_"+n+".head").prepend(v),u=document.createElement("div"),v.append(u),t.populateSliderChart(r.survey.data[a][n],x,"auto",u)}break;case"matrix_dropdown":for(var c in r.survey.data[a]){(o=new Array)[0]=new Array("");for(var f in r.survey.elements[a].settings.options)o[0][o[0].length]=r.survey.elements[a].settings.options[f].label.replace(/(<([^>]+)>)/gi,"");for(var g in r.survey.data[a][c]){m=[r.survey.elements[a].settings.columns[g].replace(/(<([^>]+)>)/gi,"")];for(var n in r.survey.elements[a].settings.options)m[m.length]=r.survey.data[a][c][g][n];o[o.length]=m}u=document.createElement("div"),p.filter(".row-"+c).append(u);b=r.survey.elements[a].settings.rows[c].replace(/(<([^>]+)>)/gi,"");t.drawBarChart(u,o,"","",b,300)}break;case"matrix":(o=new Array)[0]=new Array("");for(var f in r.survey.elements[a].settings.columns)o[0][o[0].length]=r.survey.elements[a].settings.columns[f].replace(/(<([^>]+)>)/gi,"");for(var _ in r.survey.data[a])if(void 0!==r.survey.elements[a].settings.rows[_]){var m=new Array(r.survey.elements[a].settings.rows[_].replace(/(<([^>]+)>)/gi,""));for(var y in r.survey.data[a][_])void 0!==r.survey.elements[a].settings.columns[y]&&(m[m.length]=parseFloat(r.survey.data[a][_][y]));o[o.length]=m}u=document.createElement("div"),p.append(u);b=r.survey.elements[a].title.replace(/(<([^>]+)>)/gi,"");t.drawBarChart(u,o,"","",b,300);break;case"toggle":(o=new Array)[0]=new Array("Label","Count"),o[1]=new Array(r.survey.elements[a].settings.on,r.survey.data[a].on),o[2]=new Array(r.survey.elements[a].settings.off,r.survey.data[a].off),u=document.createElement("div"),p.append(u);b=r.survey.elements[a].title.replace(/(<([^>]+)>)/gi,"");t.drawPieChart(u,o,b);break;case"sorting":var h=[];for(var f in r.survey.elements[a].settings.options)h[h.length]=r.survey.elements[a].settings.options[f].label.replace(/(<([^>]+)>)/gi,"");(o=new Array)[0]=["Label","Count"],o[1]=["Bogus",0],o[2]=[iptFSQMReport.g_data.s_presets,{v:void 0!==r.survey.data[a].preset?r.survey.data[a].preset:0,f:iptFSQMReport.g_data.s_order+"\n"+h.join("\n")}],o[3]=[iptFSQMReport.g_data.s_others,{v:void 0!==r.survey.data[a].other?r.survey.data[a].other:0,f:iptFSQMReport.g_data.s_order_custom}],u=document.createElement("div"),p.append(u);var b=r.survey.elements[a].title.replace(/(<([^>]+)>)/gi,"");t.drawPieChart(u,o,b),o=new Array,r.survey.data[a].orders.sort(function(e,t){return t-e}),o[0]=["Label","Count"],o[1]=["Bogus",0];for(var w in r.survey.data[a].orders){var i=w.split("-"),x=[];for(var f in i)void 0!==r.survey.elements[a].settings.options[i[f]]&&(x[x.length]=r.survey.elements[a].settings.options[i[f]].label.replace(/(<([^>]+)>)/gi,""));o[o.length]=[w,{v:r.survey.data[a].orders[w],f:iptFSQMReport.g_data.s_order+"\n"+x.join("\n")}]}u=document.createElement("div"),p.append(u),t.drawPieChart(u,o,iptFSQMReport.g_data.s_breakdown)}}})}),r.printer.show().find("button").filter(".ipt_fsqm_report_print").on("click",function(){r.container.printElement({leaveOpen:!0,printMode:"popup",pageTitle:document.title,printBodyOptions:{classNameToAdd:r.container.parents(".ipt_uif_common").attr("class"),styleToAdd:"padding:10px;margin:10px;background: #fff none;color:#333;font-size:12px;"}})}),"function"==typeof e.fn.iptPluginUIFAdmin&&r.container.iptPluginUIFAdmin("reinitTBAnchors"),r.loader.hide(),r.progress_bar.hide()}else t.generate_report.apply(this,[++a,r])},"json").fail(function(e,t,a){r.loader.find(".ipt_uif_ajax_loader_inner").removeClass("ipt_uif_ajax_loader_animate"),r.loader.find(".ipt_uif_ajax_loader_text").text("HTTP ERROR: "+t+" "+a)})}};e.fn.iptFSQMReport=function(a){return t[a]?t[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?(e.error("Method "+a+" does not exist on jQuery.iptFSQMReport"),this):t.init.apply(this,arguments)}}(jQuery);